version: 2

seeds:

  # Raw CRM customers (let nulls/oddities land; warn on dup codes)
  - name: atlas_crm_customer_info
    tests:
      - unique:
          column_name: customer_code
          config:
            severity: warn
    columns:
      - name: customer_code
      - name: customer_name
      - name: country_code
      - name: load_ts



  # Raw product catalog (warn on dup natural key)
  - name: atlas_catalog_product_info
    tests:
      - unique:
          column_name: product_code
          config:
            severity: warn
    columns:
      - name: product_code
      - name: product_name
      - name: category
      - name: load_ts



  # Raw plan catalog (warn on dup natural key)
  - name: atlas_catalog_plan_info
    tests:
      - unique:
          column_name: plan_code
          config:
            severity: warn
    columns:
      - name: plan_code
      - name: plan_name
      - name: product_code
      - name: billing_period
      - name: load_ts



  # Raw currency reference (warn on dup code)
  - name: atlas_currency_info
    tests:
      - unique:
          column_name: currency_code
          config:
            severity: warn
    columns:
      - name: currency_code
      - name: currency_name
      - name: decimal_digits
      - name: load_ts



  # Raw country reference (warn on dup code)
  - name: atlas_country_info
    tests:
      - unique:
          column_name: country_code
          config:
            severity: warn
    columns:
      - name: country_code
      - name: country_name
      - name: load_ts



  # Daily price book (warn if (product, plan, date) has duplicates)
  - name: atlas_price_book_daily
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: [product_code, plan_code, price_date]
          config:
            severity: warn
    columns:
      - name: product_code
      - name: plan_code
      - name: price_date
      - name: unit_price
      - name: load_ts



  # Raw metered usage (warn if (cust, product, plan, date) dupes)
  - name: atlas_meter_usage_daily
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: [customer_code, product_code, plan_code, report_date]
          config:
            severity: warn
    columns:
      - name: customer_code
      - name: product_code
      - name: plan_code
      - name: report_date
      - name: units_used
      - name: included_units
      - name: load_ts
