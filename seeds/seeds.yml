# seeds.yml
# --------------------------------------------------------------------------------
# Seeds are small, slowing changing datasets for scaffolding and reference.
#
# Lifecycle:
# 1. Seeds: CSVs are first loaded into the warehouse as static tables.
# 2. Sources: dbt then resolves the location of our raw data.
#    - In dev, our seeds act as the raw layer `_seeds`.
#    - In prod, sources instead point to real upstream raw landing schemas.
# 3. Staging models: Lightly adapts the source data before feeding it to history.
#    - In dev, staging queries the seeded tables.
#    - In prod, staging queries the real ingestion tables.
# --------------------------------------------------------------------------------

version: 2

seeds:

  # --------------------------------------------------------------------------
  # atlas_crm_customer_info
  # --------------------------------------------------------------------------
  # Simulates a CRM system-of-record. Each customer must have a unique code.
  # --------------------------------------------------------------------------

  - name: atlas_crm_customer_info
    tests:
      - unique:
          column_name: customer_code
          config:
            severity: warn
    columns:
      - name: customer_code
        description: Business key (later becomes dim_customer surrogate key)
      - name: customer_name
      - name: country_code
        description: FK to country seed
      - name: load_ts
        description: Ingestion timestamp (set via post-hook if blank)


  # --------------------------------------------------------------------------
  # atlas_catalog_product_info
  # --------------------------------------------------------------------------
  # Authoritative list of products/services. Example: API, ETL, Alerts.
  # --------------------------------------------------------------------------

  - name: atlas_catalog_product_info
    tests:
      - unique:
          column_name: product_code
          config:
            severity: warn
    columns:
      - name: product_code
        description: Business key (hashed into product_key in staging)
      - name: product_name
      - name: category
        description: Grouping/rollup (platform, data, etc.)
      - name: load_ts


  # --------------------------------------------------------------------------
  # atlas_catalog_plan_info
  # --------------------------------------------------------------------------
  # Subscription plans offered under each product.
  # Example: Basic monthly vs Enterprise annual. Drives billing logic.
  # --------------------------------------------------------------------------

  - name: atlas_catalog_plan_info
    tests:
      - unique:
          column_name: plan_code
          config:
            severity: warn
    columns:
      - name: plan_code
        description: Business key (hashed into plan_key)
      - name: plan_name
      - name: product_code
        description: FK to product
      - name: billing_period
        description: Monthly/annual cadence (informs revenue recognition)
      - name: load_ts


  # --------------------------------------------------------------------------
  # atlas_currency_info
  # --------------------------------------------------------------------------
  # Supported currencies for billing and display.
  # Example: USD (2 decimals), JPY (0 decimals).
  # --------------------------------------------------------------------------

  - name: atlas_currency_info
    tests:
      - unique:
          column_name: currency_code
          config:
            severity: warn
    columns:
      - name: currency_code
        description: Business key (hashed into currency_key)
      - name: currency_name
      - name: decimal_digits
        description: Precision for amounts
      - name: load_ts



   # --------------------------------------------------------------------------
  # atlas_country_info
  # --------------------------------------------------------------------------
  # ISO-like country list for geography rollups. Every customer must map here.
  # Default "-1" row avoids broken joins.
  # --------------------------------------------------------------------------

  - name: atlas_country_info
    tests:
      - unique:
          column_name: country_code
          config:
            severity: warn
    columns:
      - name: country_code
        description: Business key (hashed into country_key)
      - name: country_name
      - name: load_ts


  # --------------------------------------------------------------------------
  # atlas_price_book_daily
  # --------------------------------------------------------------------------
  # Official per-unit prices by product + plan + day.
  # Separates the rate card from raw usage, so billing is modular and auditable.
  # --------------------------------------------------------------------------

  - name: atlas_price_book_daily
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: [product_code, plan_code, price_date]
          config:
            severity: warn
    columns:
      - name: product_code
        description: FK to product
      - name: plan_code
        description: FK to plan
      - name: price_date
        description: Effective date of rate
      - name: unit_price
        description: Price per unit that day
      - name: load_ts


  # --------------------------------------------------------------------------
  # atlas_meter_usage_daily
  # --------------------------------------------------------------------------
  # Metered usage rows per customer + product + plan + date.
  # --------------------------------------------------------------------------

  - name: atlas_meter_usage_daily
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: [customer_code, product_code, plan_code, report_date]
          config:
            severity: warn
    columns:
      - name: customer_code
        description: Business key from CRM
      - name: product_code
        description: Business key for product
      - name: plan_code
        description: Business key for subscription plan
      - name: report_date
        description: Calendar date of usage (UTC)
      - name: units_used
        description: Actual consumption for this customer/product/plan on that date
      - name: included_units
        description: Plan allowance for that date (baseline before overages)
      - name: load_ts