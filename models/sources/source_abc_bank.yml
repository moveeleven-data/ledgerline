version: 2

sources:
  - name: abc_bank
    database: "{{ target.database }}"
    schema: source_data

    tables:
      - name: abc_bank_position           # resource name referenced in source()
        identifier: ABC_BANK_POSITION     # physical table in Snowflake
        description: >
          Landing table for positions loaded via COPY INTO. Acts as the raw source
          for staging and history models.

        loaded_at_field: ingested_at
        freshness:
          warn_after: {count: 36, period: hour}
          error_after: {count: 72, period: hour}

        tests:
          - dbt_utils.unique_combination_of_columns:
              combination_of_columns: [accountid, symbol, exchange, report_date]

        columns:
          - name: accountid
            description: Account code from ABC Bank
            tests: [not_null]

          - name: symbol
            description: Security symbol
            tests: [not_null]

          - name: exchange
            description: Exchange code
            tests: [not_null]

          - name: report_date
            description: As of date for the position snapshot
            tests: [not_null]

          - name: quantity
            description: Units held as of report_date
            tests: [not_null]

          - name: cost_base
            description: Cost basis for the position
            tests: [not_null]

          - name: position_value
            description: Market value for the position
            tests: [not_null]

          - name: currency
            description: Currency for monetary amounts
            tests: [not_null]
