version: 2

sources:
  - name: abc_bank
    database: "{{ target.database }}"
    schema: source_data

    tables:
      - name: abc_bank_position           # resource name referenced in source()
        identifier: ABC_BANK_POSITION     # physical table in Snowflake
        description: >
          Landing table for positions loaded via COPY INTO. Raw feed may
          contain nulls/dupes; downstream layers clean and conform.

        loaded_at_field: ingested_at
        freshness:
          warn_after: {count: 36, period: hour}
          error_after: {count: 72, period: hour}

        # Keep an eye on potential dupes, but don't fail the build
        tests:
          - dbt_utils.unique_combination_of_columns:
              arguments:
                combination_of_columns: [accountid, symbol, exchange, report_date]
              config:
                severity: warn

        columns:
          - name: accountid
            description: Account code from ABC Bank

          - name: symbol
            description: Security symbol

          - name: exchange
            description: Exchange code

          - name: report_date
            description: As of date for the position snapshot

          - name: quantity
            description: Units held as of report_date (may be null in raw)

          - name: cost_base
            description: Cost basis for the position (may be null in raw)

          - name: position_value
            description: Market value for the position (may be null in raw)

          - name: currency
            description: Currency for monetary amounts (may be null in raw)