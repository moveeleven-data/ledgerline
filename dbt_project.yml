name: 'market_sync_dbt'
version: '1.0.0'
config-version: 2

# dbt Cloud ignores this value for jobs/IDE.
profile: 'market_sync'

model-paths: ['models']
analysis-paths: ['analyses']
test-paths: ['tests']
seed-paths: ['seeds']
macro-paths: ['macros']
snapshot-paths: ['snapshots']

target-path: 'target'
clean-targets:
  - 'target'
  - 'dbt_packages'

models:
  market_sync_dbt:
    +persist_docs: {relation: true, columns: true}
    +enabled: "{{ var('enable_snapshots', false) }}"

    staging:
      +schema: 'staging'
      +materialized: "{{ var('stg_materialization', 'view') }}"

    refined:
      +schema: 'refined'
      +materialized: table

    marts:
      +materialized: table
      portfolio:
        +schema: 'marts_portfolio'
      market:
        +schema: 'marts_market'


seeds:
  +schema: 'seeds'
  market_sync_dbt:
    +quote_columns: false

    abc_bank_security_info:
      +column_types:
        LOAD_TS: timestamp
      +post-hook:
        - "update {{ this }} set LOAD_TS = to_timestamp('{{ run_started_at }}') where LOAD_TS is null"

    abc_bank_country_info:
      +column_types:
        LOAD_TS: timestamp
      +post-hook:
        - "update {{ this }} set LOAD_TS = to_timestamp('{{ run_started_at }}') where LOAD_TS is null"

    abc_bank_currency_info:
      +column_types:
        LOAD_TS: timestamp
      +post-hook:
        - "update {{ this }} set LOAD_TS = to_timestamp('{{ run_started_at }}') where LOAD_TS is null"

    abc_bank_exchange_info:
      +column_types:
        LOAD_TS: timestamp
      +post-hook:
        - "update {{ this }} set LOAD_TS = to_timestamp('{{ run_started_at }}') where LOAD_TS is null"

    abc_bank_account_info:
      +column_types:
        LOAD_TS: timestamp_ntz
      +post-hook:
        - "update {{ this }} set LOAD_TS = to_timestamp_ntz('{{ run_started_at }}') where LOAD_TS is null"

snapshots:
  +schema: 'history'